{% extends 'base.html.twig' %}

{% block title %}Dashboard - FitLife Pro{% endblock %}

{% block body %}
    <div class="container-fluid py-4">
        <!-- Welcome Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-gradient-primary shadow-lg border-0 rounded-4">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="avatar-circle bg-white text-primary rounded-circle d-flex align-items-center justify-content-center me-4" style="width: 80px; height: 80px;">
                                {% if app.user.firstName %}
                                    <span class="display-6 fw-bold">{{ app.user.firstName|first|upper }}</span>
                                {% else %}
                                    <i class="fas fa-user fa-3x"></i>
                                {% endif %}
                            </div>
                            <div>
                                <h1 class="text-white mb-2">Welcome back, {{ app.user.firstName ? app.user.firstName : 'Fitness Enthusiast' }}! üëã</h1>
                                <p class="text-white opacity-75 mb-0">
                                    <i class="fas fa-calendar-alt me-2"></i>{{ "now"|date("l, F j, Y") }}
                                </p>
                            </div>
                            <div class="ms-auto">
                                <div class="badge bg-white text-primary px-3 py-2 rounded-pill">
                                    <i class="fas fa-bolt me-2"></i>
                                    {% if app.user.goal %}
                                        {{ app.user.goal|replace({'_': ' '})|title }} Mode
                                    {% else %}
                                        Ready to Train
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-0 shadow-lg rounded-4 h-100 hover-lift">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle bg-gradient-blue text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 60px; height: 60px;">
                                <i class="fas fa-utensils fa-2x"></i>
                            </div>
                            <div>
                                <h6 class="text-muted mb-1">My Meal Plans</h6>
                                <h3 class="fw-bold mb-0">0</h3>
                                <small class="text-muted">+0 this week</small>
                            </div>
                        </div>
                        <a href="{{ path('app_meal_plan_index') }}" class="stretched-link"></a>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-0 shadow-lg rounded-4 h-100 hover-lift">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle bg-gradient-green text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 60px; height: 60px;">
                                <i class="fas fa-dumbbell fa-2x"></i>
                            </div>
                            <div>
                                <h6 class="text-muted mb-1">Completed Workouts</h6>
                                <h3 class="fw-bold mb-0">0</h3>
                                <small class="text-muted">+0 this week</small>
                            </div>
                        </div>
                        <a href="{{ path('app_workout_index') }}" class="stretched-link"></a>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-0 shadow-lg rounded-4 h-100 hover-lift">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle bg-gradient-purple text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 60px; height: 60px;">
                                <i class="fas fa-chart-line fa-2x"></i>
                            </div>
                            <div>
                                <h6 class="text-muted mb-1">Progress Logs</h6>
                                <h3 class="fw-bold mb-0">0</h3>
                                <small class="text-muted">Last: Never</small>
                            </div>
                        </div>
                        <a href="{{ path('app_progress_index') }}" class="stretched-link"></a>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-0 shadow-lg rounded-4 h-100 hover-lift">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle bg-gradient-orange text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 60px; height: 60px;">
                                <i class="fas fa-fire fa-2x"></i>
                            </div>
                            <div>
                                <h6 class="text-muted mb-1">Calories Today</h6>
                                <h3 class="fw-bold mb-0">0</h3>
                                <small class="text-muted">Goal: 2000</small>
                            </div>
                        </div>
                        <a href="{{ path('app_meal_plan_generate') }}" class="stretched-link"></a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-lg rounded-4">
                    <div class="card-header bg-white border-0 py-3">
                        <h3 class="mb-0 fw-bold">Quick Actions ‚ö°</h3>
                        <p class="text-muted mb-0">Get started with these quick actions</p>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <a href="{{ path('app_meal_plan_generate') }}" class="btn btn-primary btn-lg w-100 py-3 rounded-pill shadow-sm hover-lift">
                                    <i class="fas fa-utensils me-2"></i>Generate Meal Plan
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="{{ path('app_workout_index') }}" class="btn btn-success btn-lg w-100 py-3 rounded-pill shadow-sm hover-lift">
                                    <i class="fas fa-dumbbell me-2"></i>Browse Workouts
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="{{ path('app_progress_new') }}" class="btn btn-info btn-lg w-100 py-3 rounded-pill shadow-sm hover-lift">
                                    <i class="fas fa-chart-line me-2"></i>Log Progress
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="{{ path('app_user_profile') }}" class="btn btn-warning btn-lg w-100 py-3 rounded-pill shadow-sm hover-lift">
                                    <i class="fas fa-user-edit me-2"></i>Edit Profile
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Two Column Layout -->
        <div class="row">
            <!-- Left Column: Profile & Stats -->
            <div class="col-lg-8">
                <!-- User Profile Card -->
                <div class="card border-0 shadow-lg rounded-4 mb-4">
                    <div class="card-header bg-white border-0 py-3">
                        <h3 class="mb-0 fw-bold">Your Profile üìã</h3>
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="info-card p-3 rounded-3 bg-light-blue">
                                    <h6 class="text-muted mb-2">Personal Information</h6>
                                    <p class="mb-2"><i class="fas fa-user me-2 text-primary"></i><strong>Name:</strong> {{ app.user.firstName }} {{ app.user.lastName }}</p>
                                    <p class="mb-2"><i class="fas fa-envelope me-2 text-primary"></i><strong>Email:</strong> {{ app.user.email }}</p>
                                    <p class="mb-2"><i class="fas fa-birthday-cake me-2 text-primary"></i><strong>Age:</strong> {{ app.user.age ?? 'Not set' }}</p>
                                    <p class="mb-0"><i class="fas fa-calendar-plus me-2 text-primary"></i><strong>Member Since:</strong> {{ app.user.createdAt|date('M d, Y') }}</p>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="info-card p-3 rounded-3 bg-light-green">
                                    <h6 class="text-muted mb-2">Fitness Stats</h6>
                                    <p class="mb-2"><i class="fas fa-weight me-2 text-success"></i><strong>Weight:</strong> {{ app.user.weight ?? 'Not set' }} kg</p>
                                    <p class="mb-2"><i class="fas fa-ruler-vertical me-2 text-success"></i><strong>Height:</strong> {{ app.user.height ?? 'Not set' }} cm</p>
                                    <p class="mb-2"><i class="fas fa-running me-2 text-success"></i><strong>Activity Level:</strong>
                                        {% if app.user.activityLevel %}
                                            {{ app.user.activityLevel|replace({'_': ' '})|title }}
                                        {% else %}
                                            Not set
                                        {% endif %}
                                    </p>
                                    <p class="mb-0"><i class="fas fa-bullseye me-2 text-success"></i><strong>Goal:</strong>
                                        {% if app.user.goal == 'weight_loss' %}
                                            <span class="badge bg-danger">Weight Loss</span>
                                        {% elseif app.user.goal == 'muscle_gain' %}
                                            <span class="badge bg-warning">Muscle Gain</span>
                                        {% elseif app.user.goal == 'maintain' %}
                                            <span class="badge bg-info">Maintain Weight</span>
                                        {% elseif app.user.goal == 'improve_fitness' %}
                                            <span class="badge bg-success">Improve Fitness</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Not set</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Progress Summary -->
                        <div class="row">
                            <div class="col-12">
                                <div class="progress-section">
                                    <h6 class="text-muted mb-3">Weekly Progress</h6>
                                    <div class="progress mb-2" style="height: 20px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                                            Meal Plans: 25%
                                        </div>
                                    </div>
                                    <div class="progress mb-2" style="height: 20px;">
                                        <div class="progress-bar bg-info" role="progressbar" style="width: 40%" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100">
                                            Workouts: 40%
                                        </div>
                                    </div>
                                    <div class="progress mb-2" style="height: 20px;">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 15%" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100">
                                            Progress Logs: 15%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card border-0 shadow-lg rounded-4">
                    <div class="card-header bg-white border-0 py-3">
                        <h3 class="mb-0 fw-bold">Recent Activity üìù</h3>
                    </div>
                    <div class="card-body p-4">
                        <div class="activity-timeline">
                            <div class="activity-item d-flex mb-3">
                                <div class="activity-icon bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-0 fw-bold">Welcome to FitLife Pro!</p>
                                    <small class="text-muted">Account created on {{ app.user.createdAt|date('M d, Y') }}</small>
                                </div>
                            </div>

                            <div class="activity-item d-flex mb-3">
                                <div class="activity-icon bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                                    <i class="fas fa-sign-in-alt"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-0 fw-bold">You logged in</p>
                                    <small class="text-muted">Just now</small>
                                </div>
                            </div>

                            <!-- Placeholder for future activities -->
                            <div class="activity-item d-flex mb-3">
                                <div class="activity-icon bg-info text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-0 fw-bold">Tip: Complete your profile</p>
                                    <small class="text-muted">Add your weight, height and goals for better recommendations</small>
                                </div>
                            </div>

                            <div class="activity-item d-flex">
                                <div class="activity-icon bg-warning text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                                    <i class="fas fa-rocket"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-0 fw-bold">Ready to begin!</p>
                                    <small class="text-muted">Start by generating your first meal plan</small>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <a href="{{ path('app_progress_index') }}" class="btn btn-outline-primary">
                                <i class="fas fa-history me-2"></i>View Full Activity History
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Quick Tips & Goals -->
            <div class="col-lg-4">
                <!-- Daily Tip -->
                <div class="card border-0 shadow-lg rounded-4 mb-4">
                    <div class="card-header bg-white border-0 py-3">
                        <h3 class="mb-0 fw-bold">üí° Daily Tip</h3>
                    </div>
                    <div class="card-body p-4">
                        <div class="tip-card p-3 rounded-3 bg-light-yellow">
                            <h5 class="fw-bold mb-2">Stay Hydrated!</h5>
                            <p class="mb-0">Drink at least 8 glasses of water today. Proper hydration boosts metabolism and helps with weight management.</p>
                        </div>
                    </div>
                </div>

                <!-- Weekly Goals -->
                <div class="card border-0 shadow-lg rounded-4 mb-4">
                    <div class="card-header bg-white border-0 py-3">
                        <h3 class="mb-0 fw-bold">üéØ Weekly Goals</h3>
                    </div>
                    <div class="card-body p-4">
                        <div class="goals-list">
                            <div class="goal-item d-flex align-items-center mb-3">
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" id="goal1">
                                </div>
                                <div>
                                    <label class="form-check-label" for="goal1">
                                        <span class="fw-bold">Generate 2 meal plans</span>
                                        <small class="d-block text-muted">Plan your nutrition for the week</small>
                                    </label>
                                </div>
                            </div>

                            <div class="goal-item d-flex align-items-center mb-3">
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" id="goal2">
                                </div>
                                <div>
                                    <label class="form-check-label" for="goal2">
                                        <span class="fw-bold">Complete 3 workouts</span>
                                        <small class="d-block text-muted">Stay consistent with exercise</small>
                                    </label>
                                </div>
                            </div>

                            <div class="goal-item d-flex align-items-center mb-3">
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" id="goal3">
                                </div>
                                <div>
                                    <label class="form-check-label" for="goal3">
                                        <span class="fw-bold">Log progress 2 times</span>
                                        <small class="d-block text-muted">Track your improvements</small>
                                    </label>
                                </div>
                            </div>

                            <div class="goal-item d-flex align-items-center">
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" id="goal4">
                                </div>
                                <div>
                                    <label class="form-check-label" for="goal4">
                                        <span class="fw-bold">Update profile info</span>
                                        <small class="d-block text-muted">Keep your stats current</small>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="progress mt-4" style="height: 10px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <small class="text-muted d-block text-center mt-2">0% completed</small>
                    </div>
                </div>

                <!-- Quick Links -->
                <div class="card border-0 shadow-lg rounded-4">
                    <div class="card-header bg-white border-0 py-3">
                        <h3 class="mb-0 fw-bold">üîó Quick Links</h3>
                    </div>
                    <div class="card-body p-4">
                        <div class="list-group list-group-flush">
                            <a href="{{ path('app_meal_plan_index') }}" class="list-group-item list-group-item-action border-0 py-3">
                                <i class="fas fa-utensils me-3 text-primary"></i>
                                <span>My Meal Plans</span>
                            </a>
                            <a href="{{ path('app_workout_index') }}" class="list-group-item list-group-item-action border-0 py-3">
                                <i class="fas fa-dumbbell me-3 text-success"></i>
                                <span>Workout Library</span>
                            </a>
                            <a href="{{ path('app_progress_index') }}" class="list-group-item list-group-item-action border-0 py-3">
                                <i class="fas fa-chart-line me-3 text-info"></i>
                                <span>Progress Tracking</span>
                            </a>
                            <a href="{{ path('app_user_profile') }}" class="list-group-item list-group-item-action border-0 py-3">
                                <i class="fas fa-user-cog me-3 text-warning"></i>
                                <span>Account Settings</span>
                            </a>
                            <a href="{{ path('app_logout') }}" class="list-group-item list-group-item-action border-0 py-3 text-danger">
                                <i class="fas fa-sign-out-alt me-3"></i>
                                <span>Logout</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .bg-gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .bg-gradient-blue {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .bg-gradient-green {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .bg-gradient-purple {
            background: linear-gradient(135deg, #8a2387 0%, #f27121 100%);
        }

        .bg-gradient-orange {
            background: linear-gradient(135deg, #f12711 0%, #f5af19 100%);
        }

        .bg-light-blue {
            background-color: #e3f2fd;
        }

        .bg-light-green {
            background-color: #e8f5e9;
        }

        .bg-light-yellow {
            background-color: #fffde7;
        }

        .avatar-circle {
            transition: transform 0.3s;
        }

        .avatar-circle:hover {
            transform: scale(1.05);
        }

        .icon-circle {
            transition: all 0.3s;
        }

        .hover-lift {
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
        }

        .card.hover-lift:hover .icon-circle {
            transform: rotate(5deg) scale(1.1);
        }

        .info-card {
            transition: transform 0.3s;
            height: 100%;
        }

        .info-card:hover {
            transform: translateY(-3px);
        }

        .tip-card {
            border-left: 4px solid #ffc107;
        }

        .activity-item {
            padding: 10px;
            border-radius: 10px;
            transition: background-color 0.3s;
        }

        .activity-item:hover {
            background-color: rgba(0,0,0,0.02);
        }

        .goal-item {
            padding: 8px;
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        .goal-item:hover {
            background-color: rgba(0,0,0,0.02);
        }

        .list-group-item {
            transition: all 0.3s;
        }

        .list-group-item:hover {
            background-color: rgba(0,0,0,0.02);
            padding-left: 20px !important;
        }

        .rounded-4 {
            border-radius: 1rem !important;
        }

        .progress-bar {
            border-radius: 10px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .btn-lg {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }

            .display-4 {
                font-size: 2rem;
            }

            .card-body {
                padding: 1.5rem !important;
            }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Animate numbers on cards
            const counters = document.querySelectorAll('.fw-bold.mb-0');
            counters.forEach(counter => {
                if (counter.textContent === '0') {
                    const target = parseInt(counter.parentElement.nextElementSibling?.textContent?.match(/\d+/) || 0) + 1;
                    let current = 0;

                    const updateCounter = () => {
                        if (current < target) {
                            current += 0.1;
                            counter.textContent = Math.floor(current);
                            setTimeout(updateCounter, 50);
                        }
                    };

                    // Start animation after a delay
                    setTimeout(updateCounter, 1000);
                }
            });

            // Handle goal checkboxes
            const checkboxes = document.querySelectorAll('.goal-item input[type="checkbox"]');
            const progressBar = document.querySelector('.progress-bar.bg-success');

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const checkedCount = document.querySelectorAll('.goal-item input[type="checkbox"]:checked').length;
                    const totalCount = checkboxes.length;
                    const percentage = (checkedCount / totalCount) * 100;

                    // Animate progress bar
                    let currentWidth = parseFloat(progressBar.style.width) || 0;
                    const targetWidth = percentage;

                    const animateProgress = () => {
                        if (currentWidth < targetWidth) {
                            currentWidth += 1;
                            progressBar.style.width = currentWidth + '%';
                            progressBar.setAttribute('aria-valuenow', currentWidth);
                            setTimeout(animateProgress, 20);
                        }
                    };

                    animateProgress();

                    // Update percentage text
                    const percentageText = progressBar.nextElementSibling;
                    if (percentageText) {
                        percentageText.textContent = `${Math.round(percentage)}% completed`;
                    }
                });
            });

            // Welcome notification
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.className = 'alert alert-success alert-dismissible fade show position-fixed bottom-0 end-0 m-3';
                notification.style.zIndex = '1050';
                notification.style.maxWidth = '350px';
                notification.innerHTML = `
                <i class="fas fa-fire me-2"></i>
                <strong>Let's get started!</strong> Your fitness journey begins now.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
                document.body.appendChild(notification);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
            }, 1500);

            // Add confetti on first visit (check local storage)
            if (!localStorage.getItem('fitlife_welcome_shown')) {
                setTimeout(() => {
                    createConfetti();
                    localStorage.setItem('fitlife_welcome_shown', 'true');
                }, 2000);
            }

            function createConfetti() {
                const colors = ['#667eea', '#764ba2', '#11998e', '#38ef7d', '#f12711', '#f5af19'];
                for (let i = 0; i < 30; i++) {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                    position: fixed;
                    width: 10px;
                    height: 10px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    border-radius: 50%;
                    top: 0;
                    left: ${Math.random() * 100}%;
                    pointer-events: none;
                    z-index: 9999;
                    animation: confetti-fall ${Math.random() * 1 + 1}s linear forwards;
                `;

                    const keyframes = `
                    @keyframes confetti-fall {
                        0% {
                            transform: translateY(0) rotate(0deg);
                            opacity: 1;
                        }
                        100% {
                            transform: translateY(100vh) rotate(${Math.random() * 360}deg);
                            opacity: 0;
                        }
                    }
                `;

                    const style = document.createElement('style');
                    style.textContent = keyframes;
                    document.head.appendChild(style);

                    document.body.appendChild(confetti);
                    setTimeout(() => {
                        confetti.remove();
                        if (style.parentNode) {
                            style.remove();
                        }
                    }, 2000);
                }
            }
        });
    </script>
{% endblock %}
